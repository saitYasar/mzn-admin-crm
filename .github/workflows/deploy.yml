name: Secrets Check

on:
  workflow_dispatch:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: üîê Secrets eri≈üim kontrol√º
        if: github.event_name != 'pull_request' || github.event.pull_request.head.repo.full_name == github.repository
        shell: bash
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          INFISICAL_DOMAIN: ${{ secrets.INFISICAL_DOMAIN }}
          INFISICAL_IDENTITY_ID: ${{ secrets.INFISICAL_IDENTITY_ID }}
        run: |
          check_secret() {
            local name="$1"
            local value="${!name}"
            if [ -n "$value" ]; then
              local len=${#value}
              local hash=$(printf "%s" "$value" | sha256sum | cut -c1-8)
              echo "$name ‚úÖ var | length: $len | hash8: $hash"
            else
              echo "$name ‚ùå yok"
            fi
          }

          check_secret "VERCEL_TOKEN"
          check_secret "VERCEL_PROJECT_ID"
          check_secret "VERCEL_ORG_ID"
          check_secret "INFISICAL_DOMAIN"
          check_secret "INFISICAL_IDENTITY_ID"
